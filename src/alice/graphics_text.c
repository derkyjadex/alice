/*
 * Copyright (c) 2012 James Deery
 * Released under the MIT license <http://opensource.org/licenses/MIT>.
 * See COPYING for details.
 */

#include <stdint.h>
#include <stdlib.h>
#include <wchar.h>
#include <locale.h>
#include <string.h>

#include "graphics_text.h"

static uint8_t translate_char(wchar_t c)
{
	switch (c) {
		case 0x0000: return 0x00;
		case 0xfffd: return 0x01;
		case 0x2500: return 0x10;
		case 0x2502: return 0x11;
		case 0x250c: return 0x12;
		case 0x2510: return 0x13;
		case 0x2514: return 0x14;
		case 0x2518: return 0x15;
		case 0x251c: return 0x16;
		case 0x2524: return 0x17;
		case 0x252c: return 0x18;
		case 0x2534: return 0x19;
		case 0x253c: return 0x1A;
		case 0x0020: return 0x20;
		case 0x0021: return 0x21;
		case 0x0022: return 0x22;
		case 0x0023: return 0x23;
		case 0x0024: return 0x24;
		case 0x0025: return 0x25;
		case 0x0026: return 0x26;
		case 0x0027: return 0x27;
		case 0x0028: return 0x28;
		case 0x0029: return 0x29;
		case 0x002a: return 0x2A;
		case 0x002b: return 0x2B;
		case 0x002c: return 0x2C;
		case 0x002d: return 0x2D;
		case 0x002e: return 0x2E;
		case 0x002f: return 0x2F;
		case 0x0030: return 0x30;
		case 0x0031: return 0x31;
		case 0x0032: return 0x32;
		case 0x0033: return 0x33;
		case 0x0034: return 0x34;
		case 0x0035: return 0x35;
		case 0x0036: return 0x36;
		case 0x0037: return 0x37;
		case 0x0038: return 0x38;
		case 0x0039: return 0x39;
		case 0x003a: return 0x3A;
		case 0x003b: return 0x3B;
		case 0x003c: return 0x3C;
		case 0x003d: return 0x3D;
		case 0x003e: return 0x3E;
		case 0x003f: return 0x3F;
		case 0x0040: return 0x40;
		case 0x0041: return 0x41;
		case 0x0042: return 0x42;
		case 0x0043: return 0x43;
		case 0x0044: return 0x44;
		case 0x0045: return 0x45;
		case 0x0046: return 0x46;
		case 0x0047: return 0x47;
		case 0x0048: return 0x48;
		case 0x0049: return 0x49;
		case 0x004a: return 0x4A;
		case 0x004b: return 0x4B;
		case 0x004c: return 0x4C;
		case 0x004d: return 0x4D;
		case 0x004e: return 0x4E;
		case 0x004f: return 0x4F;
		case 0x0050: return 0x50;
		case 0x0051: return 0x51;
		case 0x0052: return 0x52;
		case 0x0053: return 0x53;
		case 0x0054: return 0x54;
		case 0x0055: return 0x55;
		case 0x0056: return 0x56;
		case 0x0057: return 0x57;
		case 0x0058: return 0x58;
		case 0x0059: return 0x59;
		case 0x005a: return 0x5A;
		case 0x005b: return 0x5B;
		case 0x005c: return 0x5C;
		case 0x005d: return 0x5D;
		case 0x005e: return 0x5E;
		case 0x005f: return 0x5F;
		case 0x0060: return 0x60;
		case 0x0061: return 0x61;
		case 0x0062: return 0x62;
		case 0x0063: return 0x63;
		case 0x0064: return 0x64;
		case 0x0065: return 0x65;
		case 0x0066: return 0x66;
		case 0x0067: return 0x67;
		case 0x0068: return 0x68;
		case 0x0069: return 0x69;
		case 0x006a: return 0x6A;
		case 0x006b: return 0x6B;
		case 0x006c: return 0x6C;
		case 0x006d: return 0x6D;
		case 0x006e: return 0x6E;
		case 0x006f: return 0x6F;
		case 0x0070: return 0x70;
		case 0x0071: return 0x71;
		case 0x0072: return 0x72;
		case 0x0073: return 0x73;
		case 0x0074: return 0x74;
		case 0x0075: return 0x75;
		case 0x0076: return 0x76;
		case 0x0077: return 0x77;
		case 0x0078: return 0x78;
		case 0x0079: return 0x79;
		case 0x007a: return 0x7A;
		case 0x007b: return 0x7B;
		case 0x007c: return 0x7C;
		case 0x007d: return 0x7D;
		case 0x007e: return 0x7E;
		case 0x20ac: return 0x80;
		case 0x201a: return 0x82;
		case 0x0192: return 0x83;
		case 0x201e: return 0x84;
		case 0x2026: return 0x85;
		case 0x2020: return 0x86;
		case 0x2021: return 0x87;
		case 0x02c6: return 0x88;
		case 0x2030: return 0x89;
		case 0x0160: return 0x8A;
		case 0x2039: return 0x8B;
		case 0x0152: return 0x8C;
		case 0x017d: return 0x8E;
		case 0x2018: return 0x91;
		case 0x2019: return 0x92;
		case 0x201c: return 0x93;
		case 0x201d: return 0x94;
		case 0x2022: return 0x95;
		case 0x2013: return 0x96;
		case 0x2014: return 0x97;
		case 0x02dc: return 0x98;
		case 0x2122: return 0x99;
		case 0x0161: return 0x9A;
		case 0x203a: return 0x9B;
		case 0x0153: return 0x9C;
		case 0x017e: return 0x9E;
		case 0x0178: return 0x9F;
		case 0x00a1: return 0xA1;
		case 0x00a2: return 0xA2;
		case 0x00a3: return 0xA3;
		case 0x00a4: return 0xA4;
		case 0x00a5: return 0xA5;
		case 0x00a6: return 0xA6;
		case 0x00a7: return 0xA7;
		case 0x00a8: return 0xA8;
		case 0x00a9: return 0xA9;
		case 0x00aa: return 0xAA;
		case 0x00ab: return 0xAB;
		case 0x00ac: return 0xAC;
		case 0x00ae: return 0xAE;
		case 0x00af: return 0xAF;
		case 0x00b0: return 0xB0;
		case 0x00b1: return 0xB1;
		case 0x00b2: return 0xB2;
		case 0x00b3: return 0xB3;
		case 0x00b4: return 0xB4;
		case 0x00b5: return 0xB5;
		case 0x00b6: return 0xB6;
		case 0x00b7: return 0xB7;
		case 0x00b8: return 0xB8;
		case 0x00b9: return 0xB9;
		case 0x00ba: return 0xBA;
		case 0x00bb: return 0xBB;
		case 0x00bc: return 0xBC;
		case 0x00bd: return 0xBD;
		case 0x00be: return 0xBE;
		case 0x00bf: return 0xBF;
		case 0x00c0: return 0xC0;
		case 0x00c1: return 0xC1;
		case 0x00c2: return 0xC2;
		case 0x00c3: return 0xC3;
		case 0x00c4: return 0xC4;
		case 0x00c5: return 0xC5;
		case 0x00c6: return 0xC6;
		case 0x00c7: return 0xC7;
		case 0x00c8: return 0xC8;
		case 0x00c9: return 0xC9;
		case 0x00ca: return 0xCA;
		case 0x00cb: return 0xCB;
		case 0x00cc: return 0xCC;
		case 0x00cd: return 0xCD;
		case 0x00ce: return 0xCE;
		case 0x00cf: return 0xCF;
		case 0x00d0: return 0xD0;
		case 0x00d1: return 0xD1;
		case 0x00d2: return 0xD2;
		case 0x00d3: return 0xD3;
		case 0x00d4: return 0xD4;
		case 0x00d5: return 0xD5;
		case 0x00d6: return 0xD6;
		case 0x00d7: return 0xD7;
		case 0x00d8: return 0xD8;
		case 0x00d9: return 0xD9;
		case 0x00da: return 0xDA;
		case 0x00db: return 0xDB;
		case 0x00dc: return 0xDC;
		case 0x00dd: return 0xDD;
		case 0x00de: return 0xDE;
		case 0x00df: return 0xDF;
		case 0x00e0: return 0xE0;
		case 0x00e1: return 0xE1;
		case 0x00e2: return 0xE2;
		case 0x00e3: return 0xE3;
		case 0x00e4: return 0xE4;
		case 0x00e5: return 0xE5;
		case 0x00e6: return 0xE6;
		case 0x00e7: return 0xE7;
		case 0x00e8: return 0xE8;
		case 0x00e9: return 0xE9;
		case 0x00ea: return 0xEA;
		case 0x00eb: return 0xEB;
		case 0x00ec: return 0xEC;
		case 0x00ed: return 0xED;
		case 0x00ee: return 0xEE;
		case 0x00ef: return 0xEF;
		case 0x00f0: return 0xF0;
		case 0x00f1: return 0xF1;
		case 0x00f2: return 0xF2;
		case 0x00f3: return 0xF3;
		case 0x00f4: return 0xF4;
		case 0x00f5: return 0xF5;
		case 0x00f6: return 0xF6;
		case 0x00f7: return 0xF7;
		case 0x00f8: return 0xF8;
		case 0x00f9: return 0xF9;
		case 0x00fa: return 0xFA;
		case 0x00fb: return 0xFB;
		case 0x00fc: return 0xFC;
		case 0x00fd: return 0xFD;
		case 0x00fe: return 0xFE;
		case 0x00ff: return 0xFF;
		default: return 0x01;
	}
}

void graphics_text_read_init(struct TextReadState *state, const char *input)
{
	state->input = input;
	state->length = strlen(input);
}

uint8_t graphics_text_read_next(struct TextReadState *state)
{
	wchar_t output;
	int numBytes = mbtowc(&output, state->input, state->length);
	if (numBytes <= 0) {
		return 0;
	}

	state->input += numBytes;
	state->length -= numBytes;

	return translate_char(output);
}
